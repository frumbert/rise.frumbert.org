<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>>Rise SCORM Iframe Interaction</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --edge: #00000040;
    }
    body { font-family: sans-serif; padding: 1rem; background-color: var(--bg); color: var(--fg); }
    textarea { width: 100%; height: 150px; border: 1px solid var(--edge); }
    button { margin: 1rem auto 0; }
  </style>
</head>
<body>
  <textarea id="notes"></textarea>
  <button id="save">üíæ Save</button>

  <!-- SCORM Bridge as a module -->
  <script type="module">
    import riseSCORMBridge from "./riseSCORMBridge.js";

    function getBlockScopedInteractionId(baseId = "notes") {
      const hash = location.href.split("#")[1] || "";
      const suffix = hash.replace(/[^\w]/g, "-").substring(0, 50);
      return `${baseId}-${suffix}`;
    }

    function resolveInteractionId() {
      const config = window.riseSCORMBridgeConfig || {};
      return config.interactionId || getBlockScopedInteractionId("notes");
    }

    async function waitForConfig() {
      while (typeof window.riseSCORMBridgeConfig === "undefined") {
        await new Promise(res => setTimeout(res, 10));
      }
    }

    async function init() {
      await waitForConfig();

      const { token, serverBase } = window.riseSCORMBridgeConfig;
      if (token) riseSCORMBridge.setBearerToken(token);
      if (serverBase) riseSCORMBridge.updateServerBase(serverBase);

      const interactionId = resolveInteractionId();
      const btn = document.getElementById("save");

      btn.addEventListener("click", async () => {
        const val = document.getElementById("notes").value;
        await riseSCORMBridge.saveTextContent(interactionId, val);
        btn.textContent = 'üëç Saved';
      });

      const html = await riseSCORMBridge.loadTextContent(interactionId);
      if (html) {
        const text = html
          .replace(/<p>(.*?)<\/p>/g, "$1\n")
          .trim();
        document.getElementById("notes").value = text;
      }
    }

    init();
  </script>

  <!-- and here's what mighty would inject -->

  <script>
    window.riseSCORMBridgeConfig = {
      token: "your-bearer-token-here",
      serverBase: "https://yourdomain.com", // customize this if self-hosted
      interactionId: "notes-instance-a" // optional: will fallback to auto
    };
  </script>
  <style>
  </style>


</body>
</html>