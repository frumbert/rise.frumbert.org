<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>>Rise SCORM Iframe Interaction</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --edge: #00000040;
    }
    body { font-family: sans-serif; padding: 1rem; background-color: var(--bg); color: var(--fg); }
    textarea { width: 100%; height: 150px; border: 1px solid var(--edge); }
    button { margin: 1rem auto 0;}
  </style>
</head>
<body>
  <textarea id="notes"></textarea>
  <button id="save">💾 Save</button>

  <script type="module">
    import riseSCORMBridge from './riseSCORMBridge.js';

    async function waitForConfig() {
      while (typeof window.riseSCORMBridgeConfig === "undefined") {
        await new Promise(res => setTimeout(res, 10));
      }
    }

    async function init() {
      await waitForConfig();

      const { token, serverBase } = window.riseSCORMBridgeConfig;
      if (token) riseSCORMBridge.setBearerToken(token);
      if (serverBase) riseSCORMBridge.updateServerBase(serverBase);

      const interactionId = riseSCORMBridge.resolveInteractionId();
      const btn = document.getElementById("save");
      btn.dataset.value = btn.textContent;

      btn.addEventListener("click", async () => {
        const val = document.getElementById("notes").value;
        const saved = await riseSCORMBridge.saveTextContent(val);
        btn.textContent = (saved) ? '👍 Saved' : '❌ Not saved';
        setTimeout(()=>{btn.textContent=btn.dataset.value},2000);
      });

      const html = await riseSCORMBridge.loadTextContent();
      if (html) {
        const text = html.replace(/<p>(.*?)<\/p>/g, "$1\n").trim();
        document.getElementById("notes").value = text;
      }
    }

    init();
  </script>

  <!-- and here's what mighty would inject -->

  <script>
    window.riseSCORMBridgeConfig = {
      token: "a648785304ece6b8729d7f0cad5350a9",
      serverBase: "https://rise.frumbert.org", // customize this if self-hosted
      interactionId: "notes-instance-a", // optional: will fallback to auto
      question: "How do you think Mary should respond to Joe in this situation?"
    };
  </script>
  <style>
  </style>


</body>
</html>